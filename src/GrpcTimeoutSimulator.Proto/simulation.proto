syntax = "proto3";

option csharp_namespace = "GrpcTimeoutSimulator.Proto";

package simulation;

// 模拟服务
service SimulationService {
  // 处理请求
  rpc Process (ProcessRequest) returns (ProcessResponse);
}

// 处理请求
message ProcessRequest {
  // 请求ID
  string request_id = 1;
  // 客户端发起时间 (Unix timestamp in ticks)
  int64 client_send_time_ticks = 2;
  // 请求的有效载荷大小（可选，用于模拟不同大小的请求）
  int32 payload_size = 3;
}

// 处理响应
message ProcessResponse {
  // 请求ID
  string request_id = 1;
  // 是否成功
  bool success = 2;
  // 服务端时间线（用于延迟计算）
  ServerTimeline timeline = 3;
  // 队列深度（入队时）
  int32 queue_depth_at_enqueue = 4;
}

// 服务端时间线
message ServerTimeline {
  // T2: 请求到达服务端时间 (ticks)
  int64 arrival_time_ticks = 1;
  // T3: 进入队列时间 (ticks)
  int64 enqueue_time_ticks = 2;
  // T4: 从队列取出开始处理时间 (ticks)
  int64 dequeue_time_ticks = 3;
  // T5: 处理完成时间 (ticks)
  int64 complete_time_ticks = 4;
}
